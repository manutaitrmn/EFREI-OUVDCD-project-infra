---

- name: Install git & python3
  become: true
  apt:
    update_cache: yes
    state: latest
    name:
    - git
    - python3-pip

- name: Install setup tools and force upgrade
  pip: 
    name: setuptools
    extra_args: --upgrade

- name: Install uvicorn server
  pip:
    name:
      - uvicorn[standard]

- name: Clone FastAPI repo
  git:
    repo: 'https://github.com/manutaitrmn/devops-project-fastapi.git'
    dest: /devops-project-fastapi
    clone: yes
    update: yes

- name: Install specified python requirements
  pip:
    requirements: /devops-project-fastapi/requirements.txt

- name: Run the uvicorn server
  command: uvicorn /devops-project-fastapi/main:app --host 0.0.0.0 --port 80